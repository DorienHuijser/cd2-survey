"0","keywordcounts_CD2 <- vector(mode = ""list"", length = length(cohorts)) "
"0","names(keywordcounts_CD2) <- cohorts"
"0","for (cohort in 1:length(cohorts)) {"
"0","  # PART 1: COUNT THE OCCURENCES OF EACH KEYWORD FOR EACH INSTRUMENT  "
"0","  # Select all keyword variables of this cohort"
"0","  rawkeywords <- cd2survey[,grep(paste0(cohorts[cohort], ""_Keywords""), names(cd2survey), value = TRUE),with=FALSE]"
"0","  "
"0","  # Create an empty list to put keyword counts for the current cohort (each list item = an instrument)"
"0","  keywords_count_tempname <- vector(mode = ""list"", length = length(instrumentnrs[[cohort]][, 1]))"
"0","  "
"0","  # For each instrument in the cohort, make a list item containing the keywords and their counts"
"0","  for (instrument in 1:length(keywords_count_tempname)) {"
"0","    # Initiate empty vector variable"
"0","    keyword <- character(0)"
"0","    "
"0","    # Put the contents of each instrument in 1 combined vector with spaces removed (trimmed)"
"0","    if (!is.null(rawkeywords[[instrument]])) {"
"0","      keyword <- str_trim(unlist(str_split(rawkeywords[[instrument]], "",""), use.names = FALSE))"
"0","    }"
"0","    "
"0","    # Remove the NAs and -99s, lower case all"
"0","    keyword <- keyword[keyword != ""-99"" & !is.na(keyword)]"
"0","    keyword <- tolower(keyword)"
"0","    "
"0","    # For each instrument, count the number of occurrences of each unique keyword"
"0","    y <- as.data.frame(sort(table(keyword), decreasing=TRUE))"
"0","    "
"0","    # Put the keywords and counts in the count list"
"0","    keywords_count_tempname[[instrument]] <- y"
"0","    "
"0","    # Assign instrument names (not numbers) to the list items"
"0","    tempname <- instrumentnrs[[cohort]][instrumentnrs[[cohort]]$Instrument_nr == instrument, "
"0","                                        ""Instrument_name""]"
"0","    names(keywords_count_tempname)[instrument] <- paste0(instrument,""_"", tempname)"
"0","  }"
"0","  "
"0","  # Save the keyword counts for each cohort in a cohort-count-list"
"0","  assign(paste0(""keywords_"", cohorts[cohort],""_count""), keywords_count_tempname)"
"0","    "
"0","  # PART 2: SAVE TO USABLE FORMAT"
"0","  # Initialize columns to put together in a dataframe"
"0","  instrumentnames <- names(keywords_count_tempname)"
"0","  instrumentkeywords <- character(0)"
"0","  instrumentcounts <- character(0)"
"0","  numberofrespondents <- numeric(0)"
"0","  "
"0","  # Fill vectors with values for the flat dataframe"
"0","  for (instrument in 1:length(keywords_count_tempname)) {"
"0","    instrumentkeywords[instrument] <- paste0(keywords_count_tempname[[instrument]]$keyword, "
"0","                                             collapse = "","", sep = """")"
"0","    instrumentcounts[instrument] <- paste0(keywords_count_tempname[[instrument]]$Freq, "
"0","                                           collapse = "","", sep = """")"
"0","    "
"0","    # Count the number of respondents for each instrument, ignoring NAs"
"0","    if (length(rawkeywords[[instrument]] != 0)) {"
"0","      instr <- rawkeywords[[instrument]]"
"0","      numberofrespondents[instrument] <- length(instr[!is.na(instr)])"
"0","    } else {"
"0","      numberofrespondents[instrument] <- NA"
"0","    }"
"0","  }"
"0","  "
"0","  keywordcounts_temp <- data.frame(Instrument_name=instrumentnames,"
"0","                                   Keywords = as.character(instrumentkeywords), "
"0","                                   Keyword_count = as.character(instrumentcounts), "
"0","                                   Keyword_respondents = numberofrespondents)"
"0","  "
"0","  # Remove the rows for which the Instrument_name is [#]_NA: these are nonexistent instruments"
"0","  if(sum(str_detect(keywordcounts_temp$Instrument_name,""_NA"")) > 0){"
"0","    keywordcounts_temp <- keywordcounts_temp[-grep(""[0-9]_NA"", "
"0","                                                   keywordcounts_temp$Instrument_name), ]"
"0","  }"
"0","  "
"0","  # Save the counts for each cohort in a separate variable"
"0","  assign(paste0(""keywordcounts_"", cohorts[cohort], ""_flat""), keywordcounts_temp)"
"0","  "
"0","  # Alternative: save each flat keywordcount dataframe in a place in the CD2-wide list"
"0","  keywordcounts_CD2[[cohort]] <- keywordcounts_temp"
"0","}"
